---
import BaseLayout from './BaseLayout.astro';
import Tags from '~/components/ui/Tags.astro';
import utilities from '~/data/utilities.json';
import Link from '~/components/ui/Link.astro';
import { Icon } from 'astro-icon/components';
import { Image } from 'astro:assets';
import HeroPicture from '~/components/Images/HeroPicture.astro';
import { readableDate, htmlDateString } from '~/js/utils.js';
import Skills from '~/components/Skills.astro';
import TableOfContents from '~/components/ui/TableOfContents.astro';
import WorkPreview from '~/components/ui/WorkPreview.astro';
import BlockPicture from '~/components/Images/BlockPicture.astro';

const { frontmatter, minutesRead, headings, prevPost, nextPost } = Astro.props;
let resolvedHeadings = headings;

if (frontmatter.skillset) {
    const skillHeading = { depth: 2, slug: 'skills', text: 'Skills' };
    resolvedHeadings = [skillHeading, ...headings];
}
---

<BaseLayout {...frontmatter}>
    <slot name="slothero">
        <div
            class="relative grid w-full grid-cols-1 shadow-xl shadow-black/10 lg:h-screenSvh lg:grid-cols-2 conpad:grid-cols-workcontianer"
        >
            <div
                class="relative flex h-[75vw] items-center justify-center lg:h-full"
            >
                <HeroPicture
                    src={frontmatter.cover.src}
                    credit={frontmatter.title}
                    alt={frontmatter.cover.alt}
                    widths={[400, 960, frontmatter.cover.src.width]}
                    sizes={'100vw, (min-width: var(--container-width-lg)) 50vw, (min-width: 1264px) 56.25vw'}
                    class="h-full w-full object-cover"
                    wrapper={'absolute inset-0 h-full w-full '}
                /><Image
                    src={frontmatter.logo}
                    alt={frontmatter.title + ' logo'}
                    class="relative h-auto w-auto max-w-1/3"
                />
            </div>
            <div
                class:list={[
                    'rte self-end py-4 md:pb-8 lg:pb-12 conpad:pr-0',
                    utilities.tramline.x,
                ]}
            >
                <h1 set:html={frontmatter.title} />
                <p>{frontmatter.taster}</p>
                <p class="inline-flex items-center">
                    <Icon
                        name="lucide:timer"
                        class="mr-1 inline-block h-4 w-auto"
                    />
                    {minutesRead}
                </p>
                <Tags
                    tags={frontmatter.tags}
                    url={true}
                    class:list={[
                        'flex w-full flex-wrap items-center gap-2 text-sm leading-none',
                        utilities.margin.y,
                    ]}
                />

                <p>
                    <Link
                        theme="outline"
                        isIcon={true}
                        class="hidden transform duration-300 md:inline-flex"
                        href="#start"
                    >
                        Scroll to start <Icon
                            name="lucide:mouse"
                            class="h-4 w-4 animate-nudge-down"
                        />
                    </Link>
                </p>
            </div>
        </div>
    </slot>

    <main
        id="main-content"
        class:list={[
            'relative mx-auto max-w-container ',
            utilities.tramline.double.b,
        ]}
    >
        <article id="start" class="relative">
            <div class="rte prose mx-auto max-w-3xl lg:prose-lg">
                <Skills
                    skillset={frontmatter.skillset}
                    bg={frontmatter.brand.bg}
                >
                    <h2 id="skills">Skills</h2>
                </Skills>

                {
                    frontmatter.product && (
                        <BlockPicture
                            src={frontmatter.product.src}
                            widths={[400, 1200]}
                            sizes={`(max-width: var(--container-width-md)) 75%, 480px, (min-width: var(--container-width-lg)) 768px`}
                            format="webp"
                            class="mx-auto h-auto w-3/4 md:max-w-120 lg:max-w-3xl"
                            wrapper="bg-panel-contrast"
                            alt={frontmatter.product.alt}
                            credit={frontmatter.title}
                        />
                    )
                }

                {headings && <TableOfContents headings={resolvedHeadings} />}
                <slot />
            </div>
            <aside
                class:list={[
                    'mx-auto w-full max-w-3xl',
                    utilities.tramline.y,
                    utilities.margin.t,
                ]}
            >
                <p class="inline-flex items-center">
                    <Icon
                        name="lucide:calendar"
                        class="inline-block h-4 w-auto"
                    />
                    <span class="mx-1.5">Last updated:</span>
                    <time
                        class="inline-block rounded bg-outline-pale px-1.5"
                        datetime={htmlDateString(
                            frontmatter.modDate || frontmatter.pubDate,
                        )}
                        >{
                            readableDate(
                                frontmatter.modDate || frontmatter.pubDate,
                            )
                        }
                    </time>
                </p>
                <Tags
                    tags={frontmatter.tags}
                    url={true}
                    class:list={[
                        'flex w-full flex-wrap items-center gap-2 text-sm leading-none',
                        utilities.margin.t,
                    ]}
                />
            </aside>
        </article>
    </main>
    <aside
        class:list={[
            'border-t border-outline bg-panel',
            utilities.tramline.double.y,
        ]}
    >
        <div
            class="mx-auto grid max-w-3xl grid-cols-1 items-start justify-between gap-8 bg-panel px-4 md:grid-cols-prevnext md:px-0"
        >
            {nextPost && <WorkPreview post={nextPost} preview={'next'} />}
            {prevPost && <WorkPreview post={prevPost} preview={'prev'} />}
        </div>
    </aside>
</BaseLayout>
