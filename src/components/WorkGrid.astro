---
import utilities from '~/data/utilities.json';
import Tags from '~/components/ui/Tags.astro';
import { Image } from 'astro:assets';
import { Icon } from 'astro-icon/components';

interface CoverImage {
    src: ImageMetadata;
    alt: string;
}
interface ProductImage {
    src: ImageMetadata;
    alt: string;
}
interface LogoImage {
    src: ImageMetadata;
    light?: ImageMetadata;
}

interface Props {
    title: string;
    url: string;
    cover: CoverImage;
    logo: LogoImage;
    product: ProductImage;
    taster: string;
    tags: string[];
    readTime: number;
}
const { title, url, cover, logo, product, taster, tags, readTime } =
    Astro.props;
---

<div class="holder flex rounded-tight">
    <a
        href={url}
        class="grid-rows-workcard group relative grid w-full rounded-tight bg-panel no-underline shadow-md transition-all duration-700 hover:no-underline hover:shadow-cardhover hover:duration-300 md:ring-white md:hover:ring-2"
        x-data="{ shown: false }"
        x-intersect.threshold.10="shown = true"
        x-bind:class="shown ? 'animate-appear' : 'invisible'"
    >
        <div
            class="relative block overflow-hidden bg-quiet pb-photo hover:rounded-t-tight"
        >
            <Image
                src={cover.src}
                alt={cover.alt}
                class="absolute inset-0 m-0 h-full w-full object-cover transition-transform duration-700 group-hover:scale-150 group-focus:scale-150"
                quality="high"
                widths={[400, 720]}
                sizes={`(max-width: var(--container-width-md)) calc(100vw - 2rem), calc((100vw - 4rem) *0.33), (min-width: 1264) calc(var(--container-width-max)*0.33)`}
            />
            {
                logo && (
                    <Image
                        src={logo.light || logo.src}
                        widths={[300]}
                        alt={title + ' logo'}
                        class="absolute left-1/2 top-1/2 m-auto h-auto max-w-1/3 -translate-x-1/2 -translate-y-1/2 transition-all duration-200 group-hover:max-w-1/2 group-focus:max-w-1/2 "
                    />
                )
            }
        </div>
        {
            product && (
                <Image
                    src={product.src}
                    widths={[300]}
                    alt={product.alt + ' logo'}
                    class="z-10 -mt-[75px] h-[150px] w-full object-contain transition-transform duration-700"
                />
            )
        }
        <div class="px-6">
            <p class="flex items-center text-xs text-quiet md:text-sm">
                <Icon
                    name="lucide:timer"
                    class="mr-1 inline-block h-4 w-auto"
                />{readTime}
            </p>
            <h2
                class="link mb-2 font-headline text-2xl font-extrabold"
                set:html={title}
            />
            {taster && <p set:html={taster} />}
        </div>
        <div class="p-6">
            <Tags
                {tags}
                class:list={[
                    'flex w-full flex-wrap items-center gap-2 text-sm leading-none',
                ]}
            />
        </div>
    </a>
</div>
